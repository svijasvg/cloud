[logo]: http://files.svija.love/github/readme-logo.png "Svija: SVG-based websites built in Adobe Illustrator"

*Updated 9 December, 2022 · dev.svija.love*

![Svija: SVG-based websites built in Adobe Illustrator][logo]

### How Pages Work

This document describes how pages "work" — how javascript is used to choose the right screen code, and then adapt the SVG image to the page.

Scripts are loaded in the following order:

1. system JS · sets variables for sitewide settings and this particular page
2. cookies.js · setCookie(), getCookie() and cookiesEnabled()
3. screens.js · redirect if a different screen code would fit the screen better
4. window_mgmt.js · sets rem size based on window size, taking into account if page has been reloaded while zoomed    
includes previous resize.js · adapts content to window when it's resized, but not when it's zoomed
6. sections.js · was meant for use with languages — if visitor was in a certain language, would send them back there if they come back to the site
6. tap_hightlight.js · one line that prevents touch highlights on mobile

These scripts are followed by:

- generic css
- font css
- SVG dimension css (**check this**)
- google analytics js
- GSAP js

Then, in the body:

- unsupported.html · shows messages if javascript or cookies are disabled, or IE
- initial_scroll div & .js · sets a div the size of the first SVG so the page won't scroll as it loads (from when pages were wider than window)
- window_mgmt.js · re-sets rem size based on window size, to correct for the addition of scrollbars
- accessibility · div generated by system containing hidden accessibility HTML
- CSRF token · necessary for form submission 
- SVG's and included scripts
- scripts & HTML included via pages or modules
- page_background.js · matches the page background to the first SVG element for the Safari header
- final JS · delete initial_scroll div & set page_loaded to true

---
### window_mgmt.js

This script is called twice:
1. in the head, to set the REM size
2. again in the body, to correct the REM size if scrollbars have been added

It also contains code to correct the REM size when the page is zoomed or when the window is resized.

The only complicated part is calculating the zoom level at a given moment.

#### Saved Variables

**savedScreen** · resolution of entire screen · we keep the initial value in a cookie. If it changes, we can use the saved value to caluclate the zoom in Firefox. Otherwise, unneeded.

**savedWidth** · width

---
### ways to measure width

```
document.body.clientWidth
document.body.scrollWidth
document.documentElement.scrollWidth
globalThis.innerWidth
globalThis.outerWidth
globalThis.screen.availWidth 
screen.availWidth
screen.width
window.innerWidth
window.outerWidth
window.screen.availWidth
window.screen.width
```
```
Screen {
    availWidth: 1920,
    availHeight: 1040,
    width: 1920,
    height: 1080,
    colorDepth: 24,
    pixelDepth: 24,
    top: 414,
    left: 1920,
    availTop: 414,
    availLeft: 1920
```

there are basicalyy tow cases:

firefox and not firefox

for firefox, we compare current screen size to the first measured size
for others, we...
```

//                                                              |——————————— MAC —————————————|  |——————— PC ——————|
//                                                              s100 s125  f100 f120  c100 c125  f100 f150 c100 c125
console.log('ad'+document.documentElement.scrollWidth);      // 1758 1407  1771 1476  1920 1536   914  731 1148  918
console.log('ae'+globalThis.innerWidth);                     // 1758 1406  1771 1476  1920 1536   914  731 1148  918
console.log('ak'+window.innerWidth);                         // 1758 1406  1771 1476  1920 1536   914  731 1148  918

console.log('af'+globalThis.outerWidth);                     // 1758 1758  1771 1476  1920 1920   923  739 1161 1161
console.log('al'+window.outerWidth);                         // 1758 1758  1771 1476  1920 1920   923  739 1161 1161

console.log('ag'+globalThis.screen.availWidth );             // 2560 2560  2560 2133  2560 2560  1200  960 1440 1440
console.log('ah'+screen.availWidth);                         // 2560 2560  2560 2133  2560 2560  1200  960 1440 1440
console.log('ai'+screen.width);                              // 256O 2560  2560 2133  2560 2560  1200  960 1440 1440
console.log('am'+window.screen.availWidth);                  // 2560 2560  2560 2133  2560 2560  1200  960 1440 1440
console.log('an'+window.screen.width);                       // 2560 2560  2560 2133  2560 2560  1200  960 1440 1440

```

I don't even need to know the exact zoom amount, I just need to know if it was a zoom or resize

if it's a zoom of less than 10%, it was a resize

ALL OF THIS IS THE RESIZE HANDLER
